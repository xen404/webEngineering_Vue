{"remainingRequest":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/src/pages/Checkout.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/src/pages/Checkout.vue","mtime":1607793312909},{"path":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/karton/Documents/projects/CV_GITHUB/a4-group-62/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIEFydG1hcnRTZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvQXJ0bWFydFNlcnZpY2UiOwppbXBvcnQgKiBhcyBCbGluZ1NlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9CbGluZ1NlcnZpY2UiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDaGVja291dCIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRlc3RpbmF0aW9uczogdGhpcy4kc3RvcmUuZ2V0dGVycy5zb3J0ZWREZXN0aW5hdGlvbnMsCiAgICAgIHN1YnRvdGFsUHJpY2U6IE51bWJlciwKICAgICAgY291bnRyeTogU3RyaW5nLAogICAgICBzaGlwcGluZ0Nvc3Q6IDAsCiAgICAgIHByb2Nlc3Npbmc6IGZhbHNlLAogICAgICBwcm9jZXNzaW5nU3VjY2VzczogZmFsc2UsCiAgICAgIHByb2Nlc3NpbmdGYWlsdXJlOiBmYWxzZSwKICAgICAgZXhwRGF0YTogJycsCiAgICAgIGN1c3RvbWVyOiB7CiAgICAgICAgZW1haWw6ICcnLAogICAgICAgIHNoaXBwaW5nX2FkZHJlc3M6IHsKICAgICAgICAgIG5hbWU6ICcnLAogICAgICAgICAgYWRkcmVzczogJycsCiAgICAgICAgICBjaXR5OiAnJywKICAgICAgICAgIGNvdW50cnk6ICcnLAogICAgICAgICAgcG9zdGFsX2NvZGU6ICcnLAogICAgICAgICAgcGhvbmU6ICcnCiAgICAgICAgfQogICAgICB9LAogICAgICBjYXJkOiB7CiAgICAgICAgICBjYXJkaG9sZGVyOiAnJywKICAgICAgICAgIG51bWJlcjogJycsCiAgICAgICAgICBleHBfbW9udGg6ICcnLAogICAgICAgICAgZXhwX3llYXI6ICcnLAogICAgICAgICAgY3ZjOiAnJwogICAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnN1YnRvdGFsUHJpY2UgPSAodGhpcy4kc3RvcmUuZ2V0dGVycy5jYXJ0VG90YWwvMTAwKQogIH0sCiAgbW91bnRlZCgpIHsKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzLmNhcnRJc0VtcHR5KSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCdjYXJ0JykKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9uQ291bnRyeUNoYW5nZSgpIHsKICAgICAgbGV0IGRlc3QgPSB0aGlzLmRlc3RpbmF0aW9ucy5maWx0ZXIob2JqID0+IHsKICAgICAgICByZXR1cm4gb2JqLmNvdW50cnk9PT10aGlzLmN1c3RvbWVyLnNoaXBwaW5nX2FkZHJlc3MuY291bnRyeQogICAgICB9KQogICAgICB0aGlzLnNoaXBwaW5nQ29zdCA9IGRlc3RbMF0uY29zdC8xMDAKICAgIH0sCiAgICBvbkV4cENoYW5nZSgpIHsKICAgICAgbGV0IGV4cCA9IHRoaXMuZXhwRGF0YS5zcGxpdCgnLycpCiAgICAgIHRoaXMuY2FyZC5leHBfbW9udGggPSBleHBbMF0KICAgICAgdGhpcy5jYXJkLmV4cF95ZWFyID0gZXhwWzFdCiAgICB9LAogICAgc3VibWl0Rm9ybTogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucHJvY2Vzc2luZz10cnVlCiAgICAgIGxldCBhcnRtYXJ0UmVzcCA9IGF3YWl0IEFydG1hcnRTZXJ2aWNlLmNoZWNrb3V0KHRoaXMuY3VzdG9tZXIpCiAgICAgIGxldCBibGluZ1Jlc3AgPSBhd2FpdCBCbGluZ1NlcnZpY2UuY29uZmlybVBheW1lbnRJbnRlbnQoYXJ0bWFydFJlc3AucGF5bWVudF9pbnRlbnRfaWQsIGFydG1hcnRSZXNwLmNsaWVudF9zZWNyZXQsIHRoaXMuY2FyZCkKICAgICAgY29uc29sZS5sb2coYmxpbmdSZXNwKQogICAgICBpZiAoYmxpbmdSZXNwLnN0YXR1cz09PTIwMCkgewogICAgICAgIHRoaXMucHJvY2Vzc2luZ1N1Y2Nlc3MgPSB0cnVlOwogICAgICAgIHRoaXMucHJvY2Vzc2luZ0ZhaWx1cmUgPSBmYWxzZTsKICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnByb2Nlc3NpbmdGYWlsdXJlID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTsKICAgICAgfSAKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICB0b3RhbFByaWNlOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuc3VidG90YWxQcmljZSt0aGlzLnNoaXBwaW5nQ29zdDsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["Checkout.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4GA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Checkout.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <main>\n    <div v-if=\"processingFailure\" class=\"error-message\">An error occurred during payment. Please try again.</div>\n\n    <form class=\"checkout-form\" id=\"checkout-form\" v-on:submit.prevent=\"submitForm\" v-if=\"!processing&&!processingSuccess\">\n      <fieldset>\n        <legend>Contact information</legend>\n        <div class=\"grid\">\n          <label for=\"email\">Email</label>\n          <input v-model=\"customer.email\" type=\"email\" name=\"email\" id=\"email\" required/>\n        </div>\n      </fieldset>\n\n      <fieldset>\n        <legend>Shipping address</legend>\n        <div class=\"grid\">\n          <label for=\"name\">Name</label>\n          <input v-model=\"customer.shipping_address.name\" type=\"text\" name=\"name\" id=\"name\" required/>\n\n          <label for=\"address\">Address</label>\n          <input v-model=\"customer.shipping_address.address\" type=\"text\" name=\"address\" id=\"address\" required/>\n\n          <label for=\"city\">City</label>\n          <input v-model=\"customer.shipping_address.city\" type=\"text\" name=\"city\" id=\"city\" required/>\n\n          <label for=\"country\">Country</label>\n          <select name=\"country\" id=\"country\" v-model=\"customer.shipping_address.country\" @change=\"onCountryChange()\">\n            <!-- TODO: render and bind destination options here -->\n            <option v-for=\"destination in destinations\" :key=\"destination.country\" :value=\"destination.country\">{{destination.displayName}}</option>\n          </select>\n\n          <label for=\"postalcode\">Postal code</label>\n          <input v-model=\"customer.shipping_address.postal_code\" type=\"text\" name=\"postalcode\" id=\"postalcode\" required/>\n\n          <label for=\"phone\">Phone (optional)</label>\n          <input v-model=\"customer.shipping_address.phone\" type=\"tel\" name=\"phone\" id=\"phone\" />\n        </div>\n      </fieldset>\n\n      <fieldset>\n        <legend>Card details</legend>\n        <div class=\"grid\">\n          <label for=\"cardholder\">Name on card</label>\n          <input v-model=\"card.cardholder\" type=\"text\" name=\"cardholder\" id=\"cardholder\" required />\n\n          <label for=\"cardnumber\">Card number</label>\n          <input v-model=\"card.number\" type=\"text\" name=\"cardnumber\" id=\"cardnumber\" required />\n\n          <label for=\"cardexpiry\">Expiration</label>\n          <input\n            v-model=\"expData\"\n            @change=\"onExpChange()\"\n            type=\"text\"\n            name=\"cardexpiry\"\n            id=\"cardexpiry\"\n            pattern=\"\\d{2}/\\d{4}\"\n            placeholder=\"MM/YYYY\"\n            required\n          />\n\n          <label for=\"cardcvc\">CVC</label>\n          <input\n            v-model=\"card.cvc\"\n            name=\"cardcvc\"\n            id=\"cardcvc\"\n            type=\"text\"\n            pattern=\"\\d{3}\"\n            required\n          />\n        </div>\n      </fieldset>\n\n      <div>\n        <div>\n          Subtotal: €\n          <span id=\"price-subtotal\">{{subtotalPrice.toFixed(2)}}</span>\n        </div>\n        <div>\n          Shipping Costs: €\n          <span id=\"price-shipping\">{{shippingCost.toFixed(2)}}</span>\n        </div>\n      </div>\n\n      <div>\n        <div class=\"price\">\n          Total: €\n          <span id=\"price-total\">{{totalPrice.toFixed(2)}}</span>\n        </div>\n      </div>\n\n      <div class=\"button-row\">\n        <router-link to=\"/cart\">&larr; Back to Cart</router-link>\n        <button type=\"submit\" id=\"pay-button\">Pay</button>\n      </div>\n    </form>\n\n    <h2 v-if=\"processing\">Processing payment...</h2>\n    <img v-if=\"processing\" src=\"@/assets/images/spinner.gif\" width=\"50\" height=\"50\" />\n\n    <div v-if=\"processingSuccess\">Your payment was completed successfully.</div>\n    <h2 v-if=\"processingSuccess\">Thank you for your purchase!</h2>\n    <div v-if=\"processingSuccess\">\n      <router-link to=\"/search\">&larr; Back to Search</router-link>\n    </div>\n  </main>\n</template>\n\n<script>\nimport * as ArtmartService from \"@/services/ArtmartService\";\nimport * as BlingService from \"@/services/BlingService\";\n\nexport default {\n  name: \"Checkout\",\n  data() {\n    return {\n      destinations: this.$store.getters.sortedDestinations,\n      subtotalPrice: Number,\n      country: String,\n      shippingCost: 0,\n      processing: false,\n      processingSuccess: false,\n      processingFailure: false,\n      expData: '',\n      customer: {\n        email: '',\n        shipping_address: {\n          name: '',\n          address: '',\n          city: '',\n          country: '',\n          postal_code: '',\n          phone: ''\n        }\n      },\n      card: {\n          cardholder: '',\n          number: '',\n          exp_month: '',\n          exp_year: '',\n          cvc: ''\n        }\n    }\n  },\n  created() {\n    this.subtotalPrice = (this.$store.getters.cartTotal/100)\n  },\n  mounted() {\n    if (this.$store.getters.cartIsEmpty) {\n      this.$router.push('cart')\n    }\n  },\n  methods: {\n    onCountryChange() {\n      let dest = this.destinations.filter(obj => {\n        return obj.country===this.customer.shipping_address.country\n      })\n      this.shippingCost = dest[0].cost/100\n    },\n    onExpChange() {\n      let exp = this.expData.split('/')\n      this.card.exp_month = exp[0]\n      this.card.exp_year = exp[1]\n    },\n    submitForm: async function() {\n      this.processing=true\n      let artmartResp = await ArtmartService.checkout(this.customer)\n      let blingResp = await BlingService.confirmPaymentIntent(artmartResp.payment_intent_id, artmartResp.client_secret, this.card)\n      console.log(blingResp)\n      if (blingResp.status===200) {\n        this.processingSuccess = true;\n        this.processingFailure = false;\n        this.processing = false;\n      } else {\n        this.processingFailure = true;\n        this.processing = false;\n      } \n    }\n  },\n  computed: {\n    totalPrice: function() {\n      return this.subtotalPrice+this.shippingCost;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.error-message {\n  color: red;\n}\n\n.checkout-form > div {\n  margin: 1rem 0;\n  text-align: right;\n}\n\n/* this is a workaround for a Chrome bug that disallows display:grid on fieldset elements */\n.checkout-form div.grid {\n  display: grid;\n  grid-template-columns: 1fr 300px;\n  grid-gap: 0.5em 1em;\n  align-items: center;\n}\n\n.checkout-form fieldset {\n  border: none;\n  margin: 2rem 0;\n  padding: 0;\n}\n\n.checkout-form fieldset legend {\n  font-weight: bold;\n  font-size: 1.5em;\n  margin-bottom: 0.5rem;\n}\n\n.checkout-form input {\n  -moz-appearance: textfield;\n  font-family: inherit;\n  font-size: 1em;\n  height: 1.25rem;\n  line-height: 1.25rem;\n  padding: 3px;\n  text-indent: 1.25px;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n}\n\n.button-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.price {\n  font-weight: bold;\n  font-size: 1.5rem;\n}\n\n@media (max-width: 600px) {\n  .checkout-form {\n    width: 100%;\n  }\n  .checkout-form div.grid {\n    grid-template-columns: 1fr;\n  }\n\n  .button-row {\n    flex-direction: column-reverse;\n    align-items: flex-start;\n  }\n\n  .button-row button {\n    width: 100%;\n    margin-bottom: 1em;\n  }\n}\n</style>"]}]}